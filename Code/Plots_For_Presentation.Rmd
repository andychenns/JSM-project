---
title: "Plots for Presentation"
author: "Megha Pandit"
date: "April 13, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(geojson)
library(geojsonio)
library(leaflet)
library(ggplot2)
library(maptools)
library(magrittr)

library(sf)
library(raster)
library(spData)
library(tmap)
library(mapview)
library(magick)

library(htmlwidgets)
library(htmltools)

library(animation)
library(png)
library(webshot)
```



```{r}
ny_city <- geojson_read("C:/Users/GP/Desktop/MEGHA/SemII/JSM-ASA Challenge/JSM-project/Map/nyc_sub_borough_area.geojson", what = "sp")

load("C:/Users/GP/Desktop/MEGHA/SemII/JSM-ASA Challenge/JSM-project/Data/NY.Rda")
```



```{r}
colnames(NY)[6] <- paste0("brwd")
colnames(NY)[60] <- paste0("bor_subb")

NY$subb_name <- as.numeric(as.character(NY$bor_subb))

NY$subb_name[NY$bor_subb == 101] <- "Mott Haven/Hunts Point"
NY$subb_name[NY$bor_subb == 102] <- "Morrisania/Belmont"
NY$subb_name[NY$bor_subb == 103] <- "Highbridge/South Concourse"
NY$subb_name[NY$bor_subb == 104] <- "University Heights/Fordham"
NY$subb_name[NY$bor_subb == 105] <- "Kingsbridge Heights/Mosholu"
NY$subb_name[NY$bor_subb == 106] <- "Riverdale/Kingsbridge"
NY$subb_name[NY$bor_subb == 107] <- "Soundview/Parkchester"
NY$subb_name[NY$bor_subb == 108] <- "Throgs Neck/Co-op City"
NY$subb_name[NY$bor_subb == 109] <- "Pelham Parkway"
NY$subb_name[NY$bor_subb == 110] <- "Williamsbridge/Baychester"

NY$subb_name[NY$bor_subb == 201] <- "Williamsburg/Greenpoint"
NY$subb_name[NY$bor_subb == 202] <- "Brooklyn Heights/Fort Greene"
NY$subb_name[NY$bor_subb == 203] <- "Bedford Stuyvesant"
NY$subb_name[NY$bor_subb == 204] <- "Bushwick"
NY$subb_name[NY$bor_subb == 205] <- "East New York/Starrett City"
NY$subb_name[NY$bor_subb == 206] <- "Park Slope/Carroll Gardens"
NY$subb_name[NY$bor_subb == 207] <- "Sunset Park"
NY$subb_name[NY$bor_subb == 208] <- "North Crown Heights/Prospect Heights"
NY$subb_name[NY$bor_subb == 209] <- "South Crown Heights"
NY$subb_name[NY$bor_subb == 210] <- "Bay Ridge"
NY$subb_name[NY$bor_subb == 211] <- "Bensonhurst"
NY$subb_name[NY$bor_subb == 212] <- "Borough Park"
NY$subb_name[NY$bor_subb == 213] <- "Coney Island"
NY$subb_name[NY$bor_subb == 214] <- "Flatbush"
NY$subb_name[NY$bor_subb == 215] <- "Sheepshead Bay/Gravesend"
NY$subb_name[NY$bor_subb == 216] <- "Brownsville/Ocean Hill"
NY$subb_name[NY$bor_subb == 217] <- "East Flatbush"
NY$subb_name[NY$bor_subb == 218] <- "Flatlands/Canarsie"

NY$subb_name[NY$bor_subb == 301] <- "Greenwich Village/Financial District"
NY$subb_name[NY$bor_subb == 302] <- "Lower East Side/Chinatown"
NY$subb_name[NY$bor_subb == 303] <- "Chelsea/Clinton/Midtown"
NY$subb_name[NY$bor_subb == 304] <- "Stuyvesant Town/Turtle-Bay"
NY$subb_name[NY$bor_subb == 305] <- "Upper West Side"
NY$subb_name[NY$bor_subb == 306] <- "Upper East Side"
NY$subb_name[NY$bor_subb == 307] <- "Morningside Heights/Hamilton Heights"
NY$subb_name[NY$bor_subb == 308] <- "Central Harlem"
NY$subb_name[NY$bor_subb == 309] <- "East Harlem"
NY$subb_name[NY$bor_subb == 310] <- "Washington Heights/Inwood"
  
NY$subb_name[NY$bor_subb == 401] <- "Astoria"
NY$subb_name[NY$bor_subb == 402] <- "Sunnyside/Woodside"
NY$subb_name[NY$bor_subb == 403] <- "Jackson Heights"
NY$subb_name[NY$bor_subb == 404] <- "Elmhurst/Corona"
NY$subb_name[NY$bor_subb == 405] <- "Middle Village/Ridgewood"
NY$subb_name[NY$bor_subb == 406] <- "Rego Park/Forest Hills"
NY$subb_name[NY$bor_subb == 407] <- "Flushing/Whitestone"
NY$subb_name[NY$bor_subb == 408] <- "Hillcrest/Fresh Meadows"
NY$subb_name[NY$bor_subb == 409] <- "Ozone Park/Woodhaven"
NY$subb_name[NY$bor_subb == 410] <- "South Ozone Park/Howard Beach"
NY$subb_name[NY$bor_subb == 411] <- "Bayside/Little Neck"
NY$subb_name[NY$bor_subb == 412] <- "Jamaica"
NY$subb_name[NY$bor_subb == 413] <- "Queens Village"
NY$subb_name[NY$bor_subb == 414] <- "Rockaways"

NY$subb_name[NY$bor_subb == 501] <- "North Shore"
NY$subb_name[NY$bor_subb == 502] <- "Mid-Island"
NY$subb_name[NY$bor_subb == 503] <- "South Shore"


```





```{r}
#Broken Windows - 1st Generation Immigrants
broken_windows <- NY %>%
  filter(gen == 1) %>%
  group_by(bor_subb, year, brwd) %>%
  summarise(total_brwd = n())

br_wind <- broken_windows %>%
  mutate(sum_brwd = sum(total_brwd))
br_wind$perc_brwd <- 100*br_wind$total_brwd/br_wind$sum_brwd

brwd_map <- merge(ny_city, br_wind, by = "bor_subb", duplicateGeoms = TRUE)

col2 <- colorRamps::blue2red(12)


risk.bins <- c(0,5,10,15,20,25,30,35,40,45,50,55,60)
risk.pal <- colorBin(col2, bins = risk.bins, na.color = "grey")

for (i in c(1991, seq(1993, 2017, 3))) {
    map <- leaflet(brwd_map[brwd_map$year == 1991 & brwd_map$brwd == 1,]) %>%
  addTiles() %>% addPolygons(fillColor=~risk.pal(perc_brwd),smoothFactor = 0.5, color = "black", fillOpacity = 0.9,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(bor_subb, ": ", "Broken Windows: ", perc_brwd, "%"))%>%
  addLegend("topleft", pal=risk.pal, values = ~risk.bins, opacity = 1.0, title = "% of Houses with <br> Broken Windows")
    saveWidget(map, "temp.html", selfcontained = FALSE)
    webshot("temp.html", file = sprintf('brwd_gen1_%02d.png', i), delay = 1, cliprect = NULL)
  }

png_files <- list.files(pattern = ".png")
ani.options(convert = 'C:\\Program Files\\ImageMagick-6.9.1-Q16\\convert.exe')
im.convert(files = png_files, output = "brwd_animation.gif")


#Broken Windows - 2nd Generation Immigrants
broken_windows2 <- NY %>%
  filter(gen == 2) %>%
  group_by(bor_subb, year, brwd) %>%
  summarise(total_brwd = n())

br_wind2 <- broken_windows2 %>%
  mutate(sum_brwd = sum(total_brwd))
br_wind2$perc_brwd <- 100*br_wind2$total_brwd/br_wind2$sum_brwd

brwd_map2 <- merge(ny_city, br_wind2, by = "bor_subb", duplicateGeoms = TRUE)

for (i in c(1991, seq(1993, 2017, 3))) {
    map2 <- leaflet(brwd_map2[brwd_map2$year == i & brwd_map2$brwd == 1,]) %>%
  addTiles() %>% addPolygons(fillColor=~risk.pal(perc_brwd),smoothFactor = 0.5, color = "black", fillOpacity = 0.9,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(bor_subb, ": ", "Broken Windows: ", perc_brwd, "%"))%>%
  addLegend("topleft", pal=risk.pal, values = ~risk.bins, opacity = 1.0, title = "% of Houses with <br> Broken Windows")
    saveWidget(map2, "temp.html", selfcontained = FALSE)
    webshot("temp.html", file = sprintf('brwd_gen2_%02d.png', i), delay = 1, cliprect = NULL)
  }

```



```{r}
#Boarded up windows - 1st Generation Immigrants
colnames(NY)[8] <- paste0("bowd")

boarded_windows <- NY %>%
  filter(gen == 1) %>%
  group_by(bor_subb, year, bowd) %>%
  summarise(total_bowd = n())

bo_wind <- boarded_windows %>%
  mutate(sum_bowd = sum(total_bowd))
bo_wind$perc_bowd <- 100*bo_wind$total_bowd/bo_wind$sum_bowd

bo_map <- merge(ny_city, bo_wind, by = "bor_subb", duplicateGeoms = TRUE)


  for (i in c(1991, seq(1993, 2017, 3))) {
    map <- leaflet(bo_map[bo_map$year == i & bo_map$bowd == 1,]) %>%
  addTiles() %>% addPolygons(fillColor=~risk.pal(perc_bowd),smoothFactor = 0.5, color = "black", fillOpacity = 0.9,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(bor_subb, ": ", "Boarded Up Windows: ", perc_bowd, "%"))%>%
  addLegend("topleft", pal=risk.pal, values = ~risk.bins, opacity = 1.0, title = "% of Houses with <br> Boarded Up Windows")
    saveWidget(map, "temp.html", selfcontained = FALSE)
    webshot("temp.html", file = sprintf('bowd_gen1_%02d.png', i), delay = 1, cliprect = NULL)
  }

#Boarded Up windows - 2nd Generation Immigrants
boarded_windows2 <- NY %>%
  filter(gen == 2) %>%
  group_by(bor_subb, year, bowd) %>%
  summarise(total_bowd = n())

bo_wind2 <- boarded_windows2 %>%
  mutate(sum_bowd = sum(total_bowd))
bo_wind2$perc_bowd <- 100*bo_wind2$total_bowd/bo_wind2$sum_bowd

bo_map2 <- merge(ny_city, bo_wind2, by = "bor_subb", duplicateGeoms = TRUE)


  for (i in c(1991, seq(1993, 2017, 3))) {
    map <- leaflet(bo_map2[bo_map2$year == i & bo_map2$bowd == 1,]) %>%
  addTiles() %>% addPolygons(fillColor=~risk.pal(perc_bowd),smoothFactor = 0.5, color = "black", fillOpacity = 0.9,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(bor_subb, ": ", "Boarded Up Windows: ", perc_bowd, "%"))%>%
  addLegend("topleft", pal=risk.pal, values = ~risk.bins, opacity = 1.0, title = "% of Houses with <br> Boarded Up Windows")
    saveWidget(map, "temp.html", selfcontained = FALSE)
    webshot("temp.html", file = sprintf('bowd_gen2_%02d.png', i), delay = 1, cliprect = NULL)
  }

```



```{r}
#Condition of Building

col <- grDevices::rainbow(12)
pal.bins <- c(0,5,10,15,20,25,30,35,40,45,50)
pal <- colorBin(col, bins = pal.bins, na.color = "grey")

colnames(NY)[19] <- paste0("bld")

building1 <- NY %>%
  filter(gen == 1) %>%
  group_by(bor_subb, year, bld) %>%
  summarise(total_bld = n())

bldg1 <- building1 %>%
  mutate(sum_bld = sum(total_bld))
bldg1$perc_bld <- 100*bldg1$total_bld/bldg1$sum_bld

bld_map1 <- merge(ny_city, bldg1, by = "bor_subb", duplicateGeoms = TRUE)

```









#Code for dataset required for maps and code for leaflet maps


```{r}
#Average Income, Average Rent, Average Number of Persons per Room

col_avg <- colorBin("YlGn", bins = c(8.5,9,9.5,10,10.5,11,11.5,12,12.5,13))

NY$China_gen1 <- ifelse(NY$gen==1 & NY$hhbirth == 17,1,0)
NY$Mexico_gen1 <- ifelse(NY$gen == 1 & NY$hhbirth == 14,1,0)
NY$India_gen1 <- ifelse(NY$gen == 1 & NY$hhbirth == 19,1,0)

NY$China_gen2 <- ifelse(NY$gen == 2 & NY$mombirth == 17 | NY$gen == 2 & NY$dadbirth == 17, 1,0)
NY$Mexico_gen2 <- ifelse(NY$gen == 2 & NY$mombirth == 14 | NY$gen == 2 & NY$dadbirth == 14, 1,0)
NY$India_gen2 <- ifelse(NY$gen == 2 & NY$mombirth == 19 | NY$gen == 2 & NY$dadbirth == 19, 1,0)
NY$Count <- rep(1,length(NY$borough)) 


avg_income <- NY %>%
  filter(gen == 1 | gen == 2) %>%
  group_by(year, bor_subb, subb_name, gen) %>%
  summarise(avg_inc = round(mean(hhinc),2), avg_rent = round(mean(mgrent),2), avg_npr = round(mean(npr),2), avg_room = round(mean(X_24a),2),
            avg_age = round(mean(X_1c),2), gen1_China = sum(China_gen1), gen1_Mexico = sum(Mexico_gen1),
            gen1_India = sum(India_gen1), gen2_China = sum(China_gen2), gen2_Mexico = sum(Mexico_gen2),
            gen2_India = sum(India_gen2)) %>%
  mutate(avg_ppr = round(avg_npr/avg_room, 2), log_inc = log(avg_inc), log_rent = log(avg_rent))

sub_pop <- NY %>%
  group_by(bor_subb, year)%>%
  summarise(ncount = sum(Count))

nyc_avg <- left_join(avg_income, sub_pop, by = NULL)
nyc_avg$China_1 <- round(100*nyc_avg$gen1_China/nyc_avg$ncount, 2)
nyc_avg$Mexico_1 <- round(100*nyc_avg$gen1_Mexico/nyc_avg$ncount, 2)
nyc_avg$India_1 <- round(100*nyc_avg$gen1_India/nyc_avg$ncount, 2)
nyc_avg$China_2 <- round(100*nyc_avg$gen2_China/nyc_avg$ncount, 2)
nyc_avg$Mexico_2 <- round(100*nyc_avg$gen2_Mexico/nyc_avg$ncount, 2)
nyc_avg$India_2 <- round(100*nyc_avg$gen2_India/nyc_avg$ncount, 2)

nyc_avg$nChina <- nyc_avg$gen1_China + nyc_avg$gen2_China
nyc_avg$nMexico <- nyc_avg$gen1_Mexico + nyc_avg$gen2_Mexico
nyc_avg$nIndia <- nyc_avg$gen1_India + nyc_avg$gen2_India
nyc_avg$China <- nyc_avg$China_1 + nyc_avg$China_2
nyc_avg$Mexico <- nyc_avg$Mexico_1 + nyc_avg$Mexico_2
nyc_avg$India <- nyc_avg$India_1 + nyc_avg$India_2

NYC <- nyc_avg[, -c(10:15,20:25)]

save(NYC, file = "NYC_avg.Rda")
save(NYC, file = "NYC_avg.csv")

avg_map <- merge(ny_city, NYC, by = "bor_subb", duplicateGeoms = TRUE)

```




```{r}
#Maps plotted only forone year - adjust in shiny accordingly

#Average Income Map for 1st and 2nd Generation Immigrants
#Defining colors for the map
col_avg <- colorBin("YlGn", bins = c(8.5,9,9.5,10,10.5,11,11.5,12,12.5,13))

avg_inc_1 <- leaflet(avg_map[avg_map$year == 1991 & avg_map$gen == 1,]) %>%
  addTiles() %>% addPolygons(fillColor=~col_avg(log_inc),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "Average Income: $", avg_inc))%>%
  addLegend("topleft", pal=col_avg, values = ~log_inc, opacity = 1.0, title = paste0("1991<br>1st Gen", "<br>Log Average Income")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

avg_inc_2 <- leaflet(avg_map[avg_map$year == 1991 & avg_map$gen == 2,]) %>%
  addTiles() %>% addPolygons(fillColor=~col_avg(log_inc),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "Average Income: $", avg_inc))%>%
  addLegend("topleft", pal=col_avg, values = ~log_inc, opacity = 1.0, title = paste0("1991<br>2nd Gen", "<br>Log Average Income")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

avg_inc_1
avg_inc_2
```



```{r}
#Average Rent Map for 1st and 2nd Generation Immigrants
#Defining colors for the map
col_avg1 <- rev(colorspace::heat_hcl(12))
pal_avg_rent <- colorBin(col_avg1, bins = c(4,4.5,5,5.5,6,6.5,7,7.5,8))

avg_rent_1 <- leaflet(avg_map[avg_map$year == 1991 & avg_map$gen == 1,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_avg_rent(log_rent),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "Average Rent: $", avg_rent))%>%
  addLegend("topleft", pal=pal_avg_rent, values = ~log_rent, opacity = 1.0, title = paste0("1991<br>1st Gen", "<br>Log Average Rent")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

avg_rent_2 <- leaflet(avg_map[avg_map$year == 1991 & avg_map$gen == 2,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_avg_rent(log_rent),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "Average Rent: $", avg_rent))%>%
  addLegend("topleft", pal=pal_avg_rent, values = ~log_rent, opacity = 1.0, title = paste0("1991<br>2nd Gen", "<br>Log Average Rent")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

avg_rent_1
avg_rent_2
```




```{r}
#Average number of rooms per household by sub-borough
col_room <- rev(grDevices::terrain.colors(12))
pal_room <- colorBin(col_room, bins = c(2,2.5,3,3.5,4,4.5,5,5.5,6,6.5))

avg_room_1 <- leaflet(avg_map[avg_map$year == 2017 & avg_map$gen == 1,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_room(avg_room),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "Average Number of Rooms: ", avg_room))%>%
  addLegend("topleft", pal=pal_room, values = ~avg_room, opacity = 1.0, title = paste0("1991<br>1st Gen", "<br>Average Number of Rooms")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

avg_room_2 <- leaflet(avg_map[avg_map$year == 2017 & avg_map$gen == 2,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_room(avg_room),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "Average Number of Rooms: ", avg_room))%>%
  addLegend("topleft", pal=pal_room, values = ~avg_room, opacity = 1.0, title = paste0("1991<br>1st Gen", "<br>Average Number of Rooms")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

avg_room_1
avg_room_2

```




```{r}
#Average number of persons per room

col_ppr <- colorspace::heat_hcl(12, h = c(0,-100), l = c(75,40), c = c(40,80), power = 1)
pal_ppr <- colorBin(col_ppr, bins = c(0,0.25,0.5,0.75,1,1.25))

avg_ppr_1 <- leaflet(avg_map[avg_map$year == 2017 & avg_map$gen == 1,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_ppr(avg_ppr),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "Average Number Persons per Rooms: ", avg_ppr))%>%
  addLegend("topleft", pal=pal_ppr, values = ~avg_ppr, opacity = 1.0, title = paste0("1991<br>1st Gen", "<br>Average Number of Persons<br>per Room")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

avg_ppr_2 <- leaflet(avg_map[avg_map$year == 2017 & avg_map$gen == 2,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_ppr(avg_ppr),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "Average Number Persons per Rooms: ", avg_ppr))%>%
  addLegend("topleft", pal=pal_ppr, values = ~avg_ppr, opacity = 1.0, title = paste0("1991<br>1st Gen", "<br>Average Number of Persons<br>per Room")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

avg_ppr_1
avg_ppr_2

```




```{r}
#Percentage of Chinese Immigrant Population - 1st and 2nd Generation Immigrants

col_imm <- rev(grDevices::rainbow(12))
pal_imm <- colorBin(col_imm, bins = c(0,5,10,15,20,25,30,35,40,45,50))

perc_china_1 <- leaflet(avg_map[avg_map$year == 1991 & avg_map$gen == 1,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_imm(China),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "% of 1st Generation Chinese Immigrants: ", China))%>%
  addLegend("topleft", pal=pal_imm, values = ~China, opacity = 1.0, title = paste0("1991<br>1st Gen", "<br>% of<br>Chinese Immigrants")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

perc_china_2 <- leaflet(avg_map[avg_map$year == 1991 & avg_map$gen == 2,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_imm(China),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "% of 2nd Generation Chinese Immigrants: ", China))%>%
  addLegend("topleft", pal=pal_imm, values = ~China, opacity = 1.0, title = paste0("1991<br>2nd Gen", "<br>% of<br>Chinese Immigrants")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

perc_china_1
perc_china_2

```




```{r}
#Percentage of Mexican Immigrant Population - 1st and 2nd Generation Immigrants

perc_mex_1 <- leaflet(avg_map[avg_map$year == 1991 & avg_map$gen == 1,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_imm(Mexico),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "% of 1st Generation Mexican Immigrants: ", Mexico))%>%
  addLegend("topleft", pal=pal_imm, values = ~Mexico, opacity = 1.0, title = paste0("1991<br>1st Gen", "<br>% of<br>Mexican Immigrants")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

perc_mex_2 <- leaflet(avg_map[avg_map$year == 1991 & avg_map$gen == 2,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_imm(Mexico),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "% of 2nd Generation Mexican Immigrants: ", Mexico))%>%
  addLegend("topleft", pal=pal_imm, values = ~Mexico, opacity = 1.0, title = paste0("1991<br>2nd Gen", "<br>% of<br>Mexican Immigrants")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

perc_mex_1
perc_mex_2

```




```{r}
#Percentage of Indian Immigrant Population - 1st and 2nd Generation Immigrants

perc_india_1 <- leaflet(avg_map[avg_map$year == 2017 & avg_map$gen == 1,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_imm(India),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "% of 1st Generation Indian Immigrants: ", India))%>%
  addLegend("topleft", pal=pal_imm, values = ~India, opacity = 1.0, title = paste0("1991<br>1st Gen", "<br>% of<br>Indian Immigrants")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

perc_india_2 <- leaflet(avg_map[avg_map$year == 2017 & avg_map$gen == 2,]) %>%
  addTiles() %>% addPolygons(fillColor=~pal_imm(India),smoothFactor = 0.5, color = "black", fillOpacity = 1,weight=1,highlightOptions = highlightOptions(color = "white", weight = 2.5,
      bringToFront = TRUE),label = ~paste0(subb_name, ": ", "% of 2nd Generation Indian Immigrants: ", India))%>%
  addLegend("topleft", pal=pal_imm, values = ~India, opacity = 1.0, title = paste0("1991<br>2nd Gen", "<br>% of<br>Indian Immigrants")) %>%
      setView(lat =  40.730610, lng = -73.935242, zoom = 10)

perc_india_1
perc_india_2
```



